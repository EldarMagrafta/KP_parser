<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KP String Parser & Generator</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Tab buttons -->
    <div class="tabs">
      <button class="tab-button active" onclick="showTab('installation')">
        Installation
      </button>
      <button class="tab-button" onclick="showTab('meter')">
        Meter Reading
      </button>
    </div>

    <!-- Installation KP Tab -->
    <div id="installation" class="tab-content active">
      <div class="main-container">
        <!-- Installation Parser Section -->
        <div class="card">
          <h1>Installation String Parser</h1>

          <div class="input-section">
            <label for="hexInput">Hex String Input:</label>
            <input
              type="text"
              id="hexInput"
              value="DC146024E3000000000000000000000C04074CAE999999980B2FAX4007E80C0C0B2C"
            />
            <div id="preview" class="preview"></div>
          </div>

          <div class="grid">
            <div>
              <label style="color: #ff00ff">Receiver Number:</label>
              <div class="value-box">
                <div id="receiverNumber" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #22c55e">Index:</label>
              <div class="value-box">
                <div id="index" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #f97316">Type:</label>
              <div class="value-box">
                <div id="type" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #3b82f6">Account (KP id):</label>
              <div class="value-box">
                <div id="account" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ef4444">Factor:</label>
              <div class="value-box">
                <div id="factor" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #22c55e">Medium:</label>
              <div class="value-box">
                <div id="medium" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #cc7400">Manufacturer:</label>
              <div class="value-box">
                <div id="manufacturer" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #a855f7">Meter S/N:</label>
              <div class="value-box">
                <div id="sn" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #d8c724">Signal Strength:</label>
              <div class="value-box">
                <div id="signalStrength" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ff00ff">Repeater #:</label>
              <div class="value-box">
                <div id="repeater" class="value"></div>
              </div>
            </div>
          </div>

          <div class="timestamp">
            <div>
              <label style="color: #40ff00">Year</label>
              <div class="value-box">
                <div id="year" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #0ea5e9">Month</label>
              <div class="value-box">
                <div id="month" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ca8a04">Day</label>
              <div class="value-box">
                <div id="day" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #15803d">Hour</label>
              <div class="value-box">
                <div id="hour" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ef4444">Min</label>
              <div class="value-box">
                <div id="minute" class="value"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Installation Generator Section -->
        <div class="card">
          <h1>Installation String Generator</h1>

          <div class="grid">
            <div>
              <label style="color: #ff00ff">Receiver Number:</label>
              <input
                type="number"
                id="genReceiverNumber"
                class="generator-input"
                min="0"
                max="15"
                value="1"
              />
            </div>
            <div>
              <label style="color: #22c55e">Index:</label>
              <input
                type="number"
                id="genIndex"
                class="generator-input"
                min="0"
                max="8"
                value="4"
              />
            </div>
            <div>
              <label style="color: #f97316">Type:</label>
              <select id="genType" class="generator-input">
                <option
                  value="0"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Absolute value of the meter
                </option>

                <option
                  value="1"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Received signal strength indication
                </option>
                <option
                  value="3"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Previous Reading
                </option>
                <option
                  value="4"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Analog
                </option>
                <option
                  value="5"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Previous Analog Reading
                </option>
                <option value="6">
                  Serial Number of the Meter (Installation)
                </option>
                <option
                  value="7"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Event
                </option>
                <option
                  value="E"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  On-Demand
                </option>
              </select>
            </div>
            <div>
              <label style="color: #3b82f6">Account (KP id):</label>
              <input
                type="number"
                id="genAccount"
                class="generator-input"
                value="9443"
              />
            </div>
            <div>
              <label style="color: #ef4444">Factor:</label>
              <select id="genFactor" class="generator-input">
                <option value="0.000001">0.000001</option>
                <option value="0.00001">0.00001</option>
                <option value="0.0001">0.0001</option>
                <option value="0.001">0.001</option>
                <option value="0.01" selected>0.01</option>
                <option value="0.1">0.1</option>
                <option value="1">1</option>
                <option value="10">10</option>
              </select>
            </div>
            <div>
              <label style="color: #22c55e">Medium:</label>
              <select id="genMedium" class="generator-input">
                <option value="07" selected>Water</option>
                <option value="09">Security</option>
                <option value="0F">Analog</option>
              </select>
            </div>
            <div>
              <label style="color: #cc7400">Manufacturer:</label>
              <select id="genManufacturer" class="generator-input">
                <option value="1592">Elster Meters</option>
                <option value="4CAE" selected>Sensus Meters</option>
                <option value="5345">Octave Meters</option>
                <option value="2A18">Modbus Siemens MAG6000</option>
                <option value="2A1B">Modbus Siemens MAG8000</option>
                <option value="1A1F">Modbus ABB WaterMaster</option>
                <option value="1A1D">Modbus ABB AquaMaster</option>
                <option value="2B0E">Modbus KHRONE IFC300</option>
                <option value="7A7B">Pulse Meter</option>
              </select>
            </div>
            <div>
              <label style="color: #a855f7">Meter S/N:</label>
              <input
                type="number"
                id="genSerialNumber"
                class="generator-input"
                min="0"
                max="99999999"
                value="99999998"
              />
            </div>
            <div>
              <label style="color: #d8c724">Signal Strength:</label>
              <input
                type="number"
                id="genSignalStrength"
                class="generator-input"
                min="0"
                max="255"
                value="178"
              />
            </div>
            <div>
              <label style="color: #ff00ff">Repeater #:</label>
              <input
                type="number"
                id="genRepeater"
                class="generator-input"
                min="0"
                max="255"
                value="250"
              />
            </div>
          </div>

          <div class="timestamp">
            <div>
              <label style="color: #40ff00">Year</label>
              <input
                type="number"
                id="genYear"
                class="generator-input"
                min="2000"
                max="2050"
                value="2024"
              />
            </div>
            <div>
              <label style="color: #0ea5e9">Month</label>
              <input
                type="number"
                id="genMonth"
                class="generator-input"
                min="1"
                max="12"
                value="12"
              />
            </div>
            <div>
              <label style="color: #ca8a04">Day</label>
              <input
                type="number"
                id="genDay"
                class="generator-input"
                min="1"
                max="31"
                value="12"
              />
            </div>
            <div>
              <label style="color: #15803d">Hour</label>
              <input
                type="number"
                id="genHour"
                class="generator-input"
                min="0"
                max="23"
                value="11"
              />
            </div>
            <div>
              <label style="color: #ef4444">Min</label>
              <input
                type="number"
                id="genMinute"
                class="generator-input"
                min="00"
                max="59"
                value="44"
              />
            </div>
          </div>

          <button onclick="generateInstallationHexString()">Generate</button>

          <div class="result-section">
            <div style="display: flex; align-items: center; gap: 10px">
              <label>Generated Hex String:</label>
              <button onclick="copyInstallationHexString()" class="copy-button">
                Copy
              </button>
            </div>
            <div id="generatedInstallationHex" class="preview"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Meter Reading KP Tab -->
    <div id="meter" class="tab-content">
      <div class="main-container">
        <!-- Meter Parser Section -->
        <div class="card">
          <h1>Meter Reading Parser</h1>

          <div class="input-section">
            <label for="meterHexInput">Hex String Input:</label>
            <input
              type="text"
              id="meterHexInput"
              value="DC13006694000022220000000000000000000000000000A70B513X4007E901010600"
            />
            <div id="meterPreview" class="preview"></div>
          </div>

          <div class="grid">
            <div>
              <label style="color: #ff00ff">Receiver Number:</label>
              <div class="value-box">
                <div id="meterReceiverNumber" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #22c55e">Index:</label>
              <div class="value-box">
                <div id="meterIndex" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #f97316">Type:</label>
              <div class="value-box">
                <div id="meterType" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #3b82f6">Account (KP id):</label>
              <div class="value-box">
                <div id="meterAccount" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ef4444">Current Reading:</label>
              <div class="value-box">
                <div id="currentReading" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #a855f7">Data:</label>
              <div class="value-box">
                <div id="data" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #d8c724">Signal Strength:</label>
              <div class="value-box">
                <div id="meterSignalStrength" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ff00ff">Repeater #:</label>
              <div class="value-box">
                <div id="meterRepeater" class="value"></div>
              </div>
            </div>
          </div>

          <div class="timestamp">
            <div>
              <label style="color: #40ff00">Year</label>
              <div class="value-box">
                <div id="meterYear" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #0ea5e9">Month</label>
              <div class="value-box">
                <div id="meterMonth" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ca8a04">Day</label>
              <div class="value-box">
                <div id="meterDay" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #15803d">Hour</label>
              <div class="value-box">
                <div id="meterHour" class="value"></div>
              </div>
            </div>
            <div>
              <label style="color: #ef4444">Min</label>
              <div class="value-box">
                <div id="meterMinute" class="value"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Meter Generator Section -->
        <div class="card">
          <h1>Meter Reading Generator</h1>

          <div class="grid">
            <div>
              <label style="color: #ff00ff">Receiver Number:</label>
              <input
                type="number"
                id="genMeterReceiverNumber"
                class="generator-input"
                min="0"
                max="15"
                value="1"
              />
            </div>
            <div>
              <label style="color: #22c55e">Index:</label>
              <input
                type="number"
                id="genMeterIndex"
                class="generator-input"
                min="0"
                max="8"
                value="3"
              />
            </div>
            <div>
              <label style="color: #f97316">Type:</label>
              <select id="genMeterType" class="generator-input">
                <option value="0">Absolute value of the meter</option>
                <option
                  value="1"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Received signal strength indication
                </option>
                <option
                  value="3"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Previous Reading
                </option>
                <option
                  value="4"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Analog
                </option>
                <option
                  value="5"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Previous Analog Reading
                </option>
                <option
                  value="6"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Serial Number of the Meter (Installation)
                </option>
                <option
                  value="7"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  Event
                </option>
                <option
                  value="E"
                  disabled
                  style="color: #999; background-color: #f1f1f1"
                >
                  On-Demand
                </option>
              </select>
            </div>
            <div>
              <label style="color: #3b82f6">Account (KP id):</label>
              <input
                type="number"
                id="genMeterAccount"
                class="generator-input"
                value="26260"
              />
            </div>
            <div>
              <label style="color: #ef4444">Current Reading:</label>
              <input
                type="number"
                id="genCurrentReading"
                class="generator-input"
                value="8738"
              />
            </div>
            <div>
              <label style="color: #a855f7">Data:</label>
              <input
                type="number"
                id="genData"
                class="generator-input"
                value="167"
              />
            </div>
            <div>
              <label style="color: #d8c724">Signal Strength:</label>
              <input
                type="number"
                id="genMeterSignalStrength"
                class="generator-input"
                min="0"
                max="255"
                value="181"
              />
            </div>
            <div>
              <label style="color: #ff00ff">Repeater #:</label>
              <input
                type="number"
                id="genMeterRepeater"
                class="generator-input"
                min="0"
                max="255"
                value="19"
              />
            </div>
          </div>

          <div class="timestamp">
            <div>
              <label style="color: #40ff00">Year</label>
              <input
                type="number"
                id="genMeterYear"
                class="generator-input"
                min="2000"
                max="2050"
                value="2025"
              />
            </div>
            <div>
              <label style="color: #0ea5e9">Month</label>
              <input
                type="number"
                id="genMeterMonth"
                class="generator-input"
                min="1"
                max="12"
                value="1"
              />
            </div>
            <div>
              <label style="color: #ca8a04">Day</label>
              <input
                type="number"
                id="genMeterDay"
                class="generator-input"
                min="1"
                max="31"
                value="1"
              />
            </div>
            <div>
              <label style="color: #15803d">Hour</label>
              <input
                type="number"
                id="genMeterHour"
                class="generator-input"
                min="0"
                max="23"
                value="6"
              />
            </div>
            <div>
              <label style="color: #ef4444">Min</label>
              <select id="genMeterMinute" class="generator-input">
                <option value="00">00</option>
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="45">45</option>
              </select>
            </div>
          </div>

          <button onclick="generateMeterHexString()">Generate</button>

          <div class="result-section">
            <div style="display: flex; align-items: center; gap: 10px">
              <label>Generated Hex String:</label>
              <button onclick="copyMeterHexString()" class="copy-button">
                Copy
              </button>
            </div>
            <div id="generatedMeterHex" class="preview"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Tab switching functionality
      function showTab(tabId) {
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.querySelectorAll(".tab-button").forEach((button) => {
          button.classList.remove("active");
        });
        document.getElementById(tabId).classList.add("active");
        document
          .querySelector(`button[onclick="showTab('${tabId}')"]`)
          .classList.add("active");
      }

      // Common utility functions
      function mid(text, start, length) {
        return text.substr(start - 1, length);
      }

      function hex2dec(hex) {
        return parseInt(hex, 16).toString();
      }

      function hex2bin(hexString) {
        let binary = "";
        for (let i = 0; i < hexString.length; i++) {
          let hex = hexString[i];
          let dec = parseInt(hex, 16);
          let bin = dec.toString(2).padStart(4, "0");
          binary += bin;
        }
        return binary;
      }

      function bin2dec(binary) {
        return parseInt(binary, 2);
      }

      function dec2hex(dec, padding = 2) {
        return parseInt(dec).toString(16).padStart(padding, "0").toUpperCase();
      }

      function formatDecimal(number) {
        let str = number.toFixed(6);
        str = str.replace(/\.?0+$/, "");
        return str;
      }

      // Installation-specific functions
      function getInstallationType(typeChar) {
        const types = {
          0: `<span style="color: red; text-decoration: line-through">Absolute value of the meter</span>`,
          1: `<span style="color: red; text-decoration: line-through">Received signal strength indication</span>`,
          3: `<span style="color: red; text-decoration: line-through">Previous Reading</span>`,
          4: `<span style="color: red; text-decoration: line-through">Analog</span>`,
          5: `<span style="color: red; text-decoration: line-through">Previous Analog Reading</span>`,
          6: `<span style="color: green">Serial Number of the Meter (Installation)</span>`,
          7: `<span style="color: red; text-decoration: line-through">Event</span>`,
          E: `<span style="color: red; text-decoration: line-through">On-Demand</span>`,
        };
        return (
          types[typeChar] ||
          `<span style="color: red; text-decoration: line-through">Unknown</span>`
        );
      }

      function getMedium(mediumHex) {
        const mediumValue = parseInt(mediumHex, 16);
        switch (mediumValue) {
          case 7:
            return "Water";
          case 9:
            return "Security";
          case 15:
            return "Analog";
          default:
            return "Unknown";
        }
      }

      function getManufacturer(manufacturerId) {
        const manufacturers = {
          1592: "Elster Meters",
          "4CAE": "Sensus Meters",
          5345: "Octave Meters",
          "2A18": "Modbus Siemens MAG6000",
          "2A1B": "Modbus Siemens MAG8000",
          "1A1F": "Modbus ABB WaterMaster",
          "1A1D": "Modbus ABB AquaMaster",
          "2B0E": "Modbus KHRONE IFC300",
          "7A7B": "Pulse Meter",
        };
        return manufacturers[manufacturerId] || "Unknown";
      }

      function calculateFactorHex(factorValue) {
        switch (factorValue) {
          case "0.000001":
            return "00";
          case "0.00001":
            return "01";
          case "0.0001":
            return "02";
          case "0.001":
            return "03";
          case "0.01":
            return "04";
          case "0.1":
            return "05";
          case "1":
            return "06";
          case "10":
            return "07";
        }
      }

      // Meter-specific functions
      function getMeterType(typeChar) {
        const types = {
          0: `<span style="color: green">Absolute value of the meter</span>`,
          1: `<span style="color: red; text-decoration: line-through">Received signal strength indication</span>`,
          3: `<span style="color: red; text-decoration: line-through">Previous Reading</span>`,
          4: `<span style="color: red; text-decoration: line-through">Analog</span>`,
          5: `<span style="color: red; text-decoration: line-through">Previous Analog Reading</span>`,
          6: `<span style="color: red; text-decoration: line-through">Serial Number of the Meter (Installation)</span>`,
          7: `<span style="color: red; text-decoration: line-through">Event</span>`,
          E: `<span style="color: red; text-decoration: line-through">On-Demand</span>`,
        };
        return (
          types[typeChar] ||
          `<span style="color: red; text-decoration: line-through">Unknown</span>`
        );
      }

      // render colored preview
      function renderInstallationPreview(str) {
        const parts = [
          { text: str.slice(0, 3), color: "#000000" }, // First 3 chars
          { text: str.slice(3, 4), color: "#ff00ff" }, // Receiver number
          { text: str.slice(4, 5), color: "#22c55e" }, // Index
          { text: str.slice(5, 6), color: "#f97316" }, // Type
          { text: str.slice(6, 11), color: "#3b82f6" }, // Account
          { text: str.slice(11, 33), color: "#000000" }, // reserved
          { text: str.slice(33, 35), color: "#ef4444" }, // factor
          { text: str.slice(35, 37), color: "#22c55e" }, // medium
          { text: str.slice(37, 41), color: "#cc7400" }, // water meter manufracturer
          { text: str.slice(41, 49), color: "#a855f7" }, // Meter S/N
          { text: str.slice(49, 50), color: "#000000" }, // Channel
          { text: str.slice(50, 52), color: "#d8c724" }, // Signal Strength
          { text: str.slice(52, 54), color: "#ff00ff" }, // Repeater Number
          { text: str.slice(54, 57), color: "#000000" }, // ETX + Checksum
          { text: str.slice(57, 61), color: "#40ff00" }, // Year
          { text: str.slice(61, 63), color: "#0ea5e9" }, // Month
          { text: str.slice(63, 65), color: "#ca8a04" }, // Day
          { text: str.slice(65, 67), color: "#15803d" }, // Hour
          { text: str.slice(67, 69), color: "#ef4444" }, // Minute
        ];

        let html = "";
        parts.forEach((part) => {
          html += `<span style="color: ${part.color}">${part.text}</span>`;
        });

        return html;
      }

      function renderMeterPreview(str) {
        const parts = [
          { text: str.slice(0, 3), color: "#000000" }, // STX + Constants (DC)
          { text: str.slice(3, 4), color: "#ff00ff" }, // Receiver number
          { text: str.slice(4, 5), color: "#22c55e" }, // Index
          { text: str.slice(5, 6), color: "#f97316" }, // Type
          { text: str.slice(6, 11), color: "#3b82f6" }, // Account (KP id)
          { text: str.slice(11, 19), color: "#ef4444" }, // Current reading
          { text: str.slice(19, 49), color: "#a855f7" }, // Data - 30 chars
          { text: str.slice(49, 50), color: "#000000" }, // Channel
          { text: str.slice(50, 52), color: "#d8c724" }, // Signal Strength
          { text: str.slice(52, 54), color: "#ff00ff" }, // Repeater Number
          { text: str.slice(54, 57), color: "#000000" }, // ETX + Checksum
          { text: str.slice(57, 61), color: "#40ff00" }, // Year
          { text: str.slice(61, 63), color: "#0ea5e9" }, // Month
          { text: str.slice(63, 65), color: "#ca8a04" }, // Day
          { text: str.slice(65, 67), color: "#15803d" }, // Hour
          { text: str.slice(67, 69), color: "#ef4444" }, // Minute
        ];

        let html = "";
        parts.forEach((part) => {
          html += `<span style="color: ${part.color}">${part.text}</span>`;
        });

        return html;
      }

      // Parse functions
      function parseInstallationHexString(hexString) {
        try {
          document.getElementById("preview").innerHTML =
            renderInstallationPreview(hexString);

          document.getElementById("receiverNumber").textContent = mid(
            hexString,
            4,
            1
          );
          document.getElementById("index").textContent = mid(hexString, 5, 1);
          document.getElementById("type").innerHTML = getInstallationType(
            mid(hexString, 6, 1)
          );
          document.getElementById("account").textContent = hex2dec(
            mid(hexString, 7, 5)
          );

          document.getElementById("factor").textContent = mid(hexString, 34, 2);
          let x = mid(hexString, 34, 2);
          x = hex2bin(x);
          x = bin2dec(x.slice(-3)) - 6;
          let factor = 10 ** x;
          document.getElementById("factor").textContent = formatDecimal(factor);

          document.getElementById("medium").textContent = getMedium(
            mid(hexString, 36, 2)
          );
          document.getElementById("manufacturer").textContent = getManufacturer(
            mid(hexString, 38, 4)
          );
          document.getElementById("sn").textContent = mid(hexString, 42, 8);
          document.getElementById("signalStrength").textContent = hex2dec(
            mid(hexString, 51, 2)
          );
          document.getElementById("repeater").textContent = hex2dec(
            mid(hexString, 53, 2)
          );

          document.getElementById("year").textContent = hex2dec(
            mid(hexString, 58, 4)
          );
          document.getElementById("month").textContent = hex2dec(
            mid(hexString, 62, 2)
          );
          document.getElementById("day").textContent = hex2dec(
            mid(hexString, 64, 2)
          );
          document.getElementById("hour").textContent = hex2dec(
            mid(hexString, 66, 2)
          );
          document.getElementById("minute").textContent = hex2dec(
            mid(hexString, 68, 2)
          );
        } catch (error) {
          console.error("Error parsing installation hex string:", error);
        }
      }

      function parseMeterHexString(hexString) {
        try {
          document.getElementById("meterPreview").innerHTML =
            renderMeterPreview(hexString);

          document.getElementById("meterReceiverNumber").textContent = mid(
            hexString,
            4,
            1
          );
          document.getElementById("meterIndex").textContent = mid(
            hexString,
            5,
            1
          );
          document.getElementById("meterType").innerHTML = getMeterType(
            mid(hexString, 6, 1)
          );
          document.getElementById("meterAccount").textContent = hex2dec(
            mid(hexString, 7, 5)
          );
          document.getElementById("currentReading").textContent = hex2dec(
            mid(hexString, 12, 8)
          );
          document.getElementById("data").textContent = hex2dec(
            mid(hexString, 20, 30)
          );
          document.getElementById("meterSignalStrength").textContent = hex2dec(
            mid(hexString, 51, 2)
          );
          document.getElementById("meterRepeater").textContent = hex2dec(
            mid(hexString, 53, 2)
          );

          document.getElementById("meterYear").textContent = hex2dec(
            mid(hexString, 58, 4)
          );
          document.getElementById("meterMonth").textContent = hex2dec(
            mid(hexString, 62, 2)
          );
          document.getElementById("meterDay").textContent = hex2dec(
            mid(hexString, 64, 2)
          );
          document.getElementById("meterHour").textContent = hex2dec(
            mid(hexString, 66, 2)
          );
          document.getElementById("meterMinute").textContent = hex2dec(
            mid(hexString, 68, 2)
          );
        } catch (error) {
          console.error("Error parsing meter hex string:", error);
        }
      }

      // Generate functions
      function generateInstallationHexString() {
        try {
          const receiverNumber =
            document.getElementById("genReceiverNumber").value;
          const index = document.getElementById("genIndex").value;
          const type = document.getElementById("genType").value;
          const account = document.getElementById("genAccount").value;
          const factor = document.getElementById("genFactor").value;
          const medium = document.getElementById("genMedium").value;
          const manufacturer = document.getElementById("genManufacturer").value;
          const serial = document.getElementById("genSerialNumber").value;
          const signalStrength =
            document.getElementById("genSignalStrength").value;
          const repeater = document.getElementById("genRepeater").value;
          const year = document.getElementById("genYear").value;
          const month = document.getElementById("genMonth").value;
          const day = document.getElementById("genDay").value;
          const hour = document.getElementById("genHour").value;
          const minute = document.getElementById("genMinute").value;

          if (
            !validateInput(year, 2000, 9999) ||
            !validateInput(month, 1, 12) ||
            !validateInput(day, 1, 31) ||
            !validateInput(hour, 0, 23) ||
            !validateInput(minute, 0, 59)
          ) {
            alert("Error in timestamp values");
            return;
          }

          let hexString = "DC";
          hexString += dec2hex(receiverNumber, 1);
          hexString += dec2hex(index, 1);
          hexString += type;
          hexString += dec2hex(account, 5);
          hexString += "000000000000000000000C";
          hexString += calculateFactorHex(factor);
          hexString += medium;
          hexString += manufacturer;
          hexString += serial;
          hexString += "0";
          hexString += dec2hex(signalStrength, 2);
          hexString += dec2hex(repeater, 2);
          hexString += "X40";
          hexString += dec2hex(year, 4);
          hexString += dec2hex(month, 2);
          hexString += dec2hex(day, 2);
          hexString += dec2hex(hour, 2);
          hexString += dec2hex(minute, 2);

          document.getElementById("generatedInstallationHex").innerHTML =
            renderInstallationPreview(hexString);
        } catch (error) {
          console.error("Error generating installation hex string:", error);
          alert("Error generating hex string. Please check your input values.");
        }
      }

      function generateMeterHexString() {
        try {
          const receiverNumber = document.getElementById(
            "genMeterReceiverNumber"
          ).value;
          const index = document.getElementById("genMeterIndex").value;
          const type = document.getElementById("genMeterType").value;
          const account = document.getElementById("genMeterAccount").value;
          const currentReading =
            document.getElementById("genCurrentReading").value;
          const data = document.getElementById("genData").value;
          const signalStrength = document.getElementById(
            "genMeterSignalStrength"
          ).value;
          const repeater = document.getElementById("genMeterRepeater").value;
          const year = document.getElementById("genMeterYear").value;
          const month = document.getElementById("genMeterMonth").value;
          const day = document.getElementById("genMeterDay").value;
          const hour = document.getElementById("genMeterHour").value;
          const minute = document.getElementById("genMeterMinute").value;

          if (
            !validateInput(year, 2000, 9999) ||
            !validateInput(month, 1, 12) ||
            !validateInput(day, 1, 31) ||
            !validateInput(hour, 0, 23)
          ) {
            alert("Error in timestamp values");
            return;
          }

          let hexString = "DC";
          hexString += dec2hex(receiverNumber, 1);
          hexString += dec2hex(index, 1);
          hexString += type;
          hexString += dec2hex(account, 5);
          hexString += dec2hex(currentReading, 8);
          hexString += dec2hex(data, 30).padStart(30, "0");
          hexString += "0";
          hexString += dec2hex(signalStrength, 2);
          hexString += dec2hex(repeater, 2);
          hexString += "X40";
          hexString += dec2hex(year, 4);
          hexString += dec2hex(month, 2);
          hexString += dec2hex(day, 2);
          hexString += dec2hex(hour, 2);
          hexString += dec2hex(minute, 2);

          document.getElementById("generatedMeterHex").innerHTML =
            renderMeterPreview(hexString);
        } catch (error) {
          console.error("Error generating meter hex string:", error);
          alert("Error generating hex string. Please check your input values.");
        }
      }

      // Copy functions
      function copyInstallationHexString() {
        const hexString = document
          .getElementById("generatedInstallationHex")
          .textContent.trim();
        copyToClipboard(hexString, "installation");
      }

      function copyMeterHexString() {
        const hexString = document
          .getElementById("generatedMeterHex")
          .textContent.trim();
        copyToClipboard(hexString, "meter");
      }

      function copyToClipboard(text, type) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            const button = document.querySelector(`#${type} .copy-button`);
            button.textContent = "Copied!";
            setTimeout(() => {
              button.textContent = "Copy";
            }, 1500);
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
            alert("Failed to copy to clipboard");
          });
      }

      // Validation function
      function validateInput(value, min, max) {
        const num = parseInt(value);
        return !isNaN(num) && num >= min && num <= max;
      }

      // Event listeners
      document
        .getElementById("hexInput")
        .addEventListener("input", function (e) {
          parseInstallationHexString(e.target.value);
        });

      document
        .getElementById("meterHexInput")
        .addEventListener("input", function (e) {
          parseMeterHexString(e.target.value);
        });

      // Initial parse
      parseInstallationHexString(document.getElementById("hexInput").value);
      parseMeterHexString(document.getElementById("meterHexInput").value);
    </script>
  </body>
</html>
